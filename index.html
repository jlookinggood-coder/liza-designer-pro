<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liza's Creative Studio</title>
    <style>
        :root { --accent: #d00056; --soft: #ffb3c1; --light: #fff5f7; }
        body { margin: 0; background: var(--light); font-family: 'Segoe UI', sans-serif; display: flex; overflow: hidden; height: 100vh; }
        
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--light); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; }
        .login-box { background: white; padding: 40px; border-radius: 30px; border: 1px solid var(--soft); text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        
        #main-studio { display: none; width: 100%; height: 100%; }
        #sidebar { width: 350px; background: white; border-right: 1px solid var(--soft); padding: 20px; overflow-y: auto; height: 100vh; box-sizing: border-box; }
        #viewer { flex-grow: 1; height: 100vh; background: #ffffff; position: relative; }
        
        h1 { color: var(--accent); font-size: 1.2rem; margin-bottom: 20px; border-bottom: 1px solid var(--light); padding-bottom: 10px; }
        label { display: block; font-size: 0.7rem; font-weight: bold; color: var(--accent); text-transform: uppercase; margin: 15px 0 5px 0; }
        input, select { width: 100%; padding: 10px; border: 1px solid var(--soft); border-radius: 8px; box-sizing: border-box; }
        .btn { padding: 12px; border-radius: 25px; border: none; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; transition: 0.3s; }
        .primary { background: var(--accent); color: white; }
        
        #hero-portal { margin-top: 40px; padding: 15px; background: #fdf2f4; border-radius: 15px; border: 1px dashed var(--soft); }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-box">
            <h2 style="color:var(--accent)">Liza's Creative Studio</h2>
            <p id="display-reflection" style="color:#888; margin-bottom:20px;">Celebrating 40 Years of Strength and Love</p>
            <input type="password" id="pass-input" placeholder="Secret Code" style="text-align:center; width: 200px;">
            <br><br>
            <button class="btn primary" onclick="checkPass()" style="width:200px">Unlock Studio</button>
        </div>
    </div>

    <div id="main-studio">
        <div id="sidebar">
            <h1>ðŸŽ¨ Studio Pro</h1>
            
            <label>1. Design Text</label>
            <input type="text" id="text-input" placeholder="Enter text..." oninput="updateModel()">
            
            <label>2. Tool Type</label>
            <select id="mode-select" onchange="updateModel()">
                <option value="cutter">Cookie Cutter</option>
                <option value="roller">Artisan Roller</option>
                <option value="stamp">Stamp / Embosser</option>
            </select>

            <label>3. Visual Color</label>
            <input type="color" id="color-picker" value="#d00056" oninput="updateModel()">

            <button class="btn primary" onclick="exportFile()">ðŸ’¾ DOWNLOAD STL</button>

            <div id="hero-portal">
                <label style="color:#888">Hero's Portal</label>
                <input type="text" id="new-reflection" placeholder="New login message...">
                <button class="btn" onclick="updateReflection()" style="background:white; border:1px solid var(--soft); font-size:0.7rem;">Update Message</button>
            </div>
        </div>
        <div id="viewer"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/exporters/STLExporter.js"></script>

    <script>
        const pass = "Amor@1985";
        let scene, camera, renderer, group, font;

        // Load saved message
        window.onload = () => {
            const saved = localStorage.getItem('liza_msg');
            if(saved) document.getElementById('display-reflection').innerText = saved;
        };

        function updateReflection() {
            const msg = document.getElementById('new-reflection').value;
            if(msg) {
                localStorage.setItem('liza_msg', msg);
                alert("Message updated! Refresh the page to see it on login.");
            }
        }

        function checkPass() {
            if(document.getElementById('pass-input').value === pass) {
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('main-studio').style.display = 'flex';
                init();
            } else { alert("Incorrect Code, Amor."); }
        }

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xffffff);
            camera = new THREE.PerspectiveCamera(45, (window.innerWidth - 350) / window.innerHeight, 0.1, 1000);
            camera.position.set(0, -100, 150);
            camera.lookAt(0,0,0);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth - 350, window.innerHeight);
            document.getElementById('viewer').appendChild(renderer.domElement);

            scene.add(new THREE.HemisphereLight(0xffffff, 0xbbbbbb, 1));
            group = new THREE.Group();
            scene.add(group);

            new THREE.FontLoader().load('https://threejs.org/examples/fonts/helvetiker_bold.typeface.json', (f) => {
                font = f;
                updateModel();
            });

            animate();
        }

        function updateModel() {
            if (!font) return;
            
            // THE CRUCIAL FIX: This clears the scene so shapes don't stack
            while(group.children.length > 0) { group.remove(group.children[0]); }

            const text = document.getElementById('text-input').value || "LIZA";
            const mode = document.getElementById('mode-select').value;
            const color = document.getElementById('color-picker').value;
            const shapes = font.generateShapes(text, 25);
            const mat = new THREE.MeshStandardMaterial({ color: color });

            shapes.forEach(shape => {
                if (mode === "roller") {
                    // Roller Base
                    group.add(new THREE.Mesh(new THREE.CylinderGeometry(20, 20, 80, 32), mat));
                    // Pattern wrapped once
                    const ext = new THREE.ExtrudeGeometry(shape, {depth: 2, bevelEnabled: false});
                    const pMesh = new THREE.Mesh(ext, mat);
                    pMesh.position.set(18, -10, 0); pMesh.rotation.y = Math.PI/2; pMesh.scale.set(0.3, 0.3, 0.3);
                    group.add(pMesh);
                } else {
                    // Cookie Cutter Blade
                    const blade = new THREE.ExtrudeGeometry(shape, { depth: 15, bevelEnabled: true, bevelSize: 0.5 });
                    group.add(new THREE.Mesh(blade, mat));
                    // Handle Base
                    const handle = new THREE.ExtrudeGeometry(shape, { depth: 4, bevelEnabled: true, bevelSize: 2 });
                    const hMesh = new THREE.Mesh(handle, mat);
                    hMesh.position.z = -3;
                    group.add(hMesh);
                }
            });

            const box = new THREE.Box3().setFromObject(group);
            group.position.sub(box.getCenter(new THREE.Vector3()));
        }

        function exportFile() {
            const exporter = new THREE.STLExporter();
            const result = exporter.parse(group);
            const blob = new Blob([result], {type: 'text/plain'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'Studio_Design.stl';
            link.click();
        }

        function animate() {
            requestAnimationFrame(animate);
            group.rotation.y += 0.005;
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>
